<!DOCTYPE html>
<html>
<head>
  <title>Step Counter</title>
</head>
<body>
  <h1>Step Counter</h1>
  <button id="startButton">Start</button>
  <button id="stopButton" disabled>Stop</button>
  <p>Step Count: <span id="stepCount">0</span></p>

  <script>
    let stepCount = 0;
    let sensor;
    let isStepDetected = false;
    let previousAcceleration = 0;
    const accelerationData = [];
    const thresholdFactor = 1.2; // Adjust the threshold factor based on your requirements
    const stepDelay = 1000; // Adjust the step delay (in milliseconds) based on your requirements

    function generateRandomColor() {
      const letters = '0123456789ABCDEF';
      let color = '#';
      for (let i = 0; i < 6; i++) {
        color += letters[Math.floor(Math.random() * 16)];
      }
      return color;
    }

    function setRandomBackgroundColor() {
      const body = document.body;
      const randomColor = generateRandomColor();
      body.style.backgroundColor = randomColor;
    }

    // Set random background color on initial page load
    setRandomBackgroundColor();

    function calculateThreshold() {
      const maxAcceleration = Math.max(...accelerationData);
      return maxAcceleration * thresholdFactor;
    }

    function startStepCounter() {
      if ('Accelerometer' in window) {
        sensor = new Accelerometer({ frequency: 60 });

        sensor.addEventListener('reading', () => {
          const acceleration = Math.hypot(sensor.x, sensor.y, sensor.z);

          accelerationData.push(acceleration);

          if (accelerationData.length > 10) {
            accelerationData.shift();

            const threshold = calculateThreshold();

            if (!isStepDetected && acceleration > threshold && acceleration > previousAcceleration) {
              isStepDetected = true;
              setTimeout(() => {
                isStepDetected = false;
              }, stepDelay);
            } else if (isStepDetected && acceleration <= threshold) {
              isStepDetected = false;
              stepCount++;
              document.getElementById('stepCount').textContent = stepCount;
            }
          }

          previousAcceleration = acceleration;
        });

        sensor.start();

        document.getElementById('startButton').disabled = true;
        document.getElementById('stopButton').disabled = false;
      } else {
        console.log('Accelerometer API not supported');
      }
    }

    function stopStepCounter() {
      if (sensor) {
        sensor.stop();
        sensor = null;
        isStepDetected = false;
        accelerationData.length = 0;

        document.getElementById('startButton').disabled = false;
        document.getElementById('stopButton').disabled = true;
      }
    }

    document.getElementById('startButton').addEventListener('click', startStepCounter);
    document.getElementById('stopButton').addEventListener('click', stopStepCounter);
  </script>
</body>
</html>
